<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern E-commerce Website</title>
    <link rel="stylesheet" href="bootstrap-5.3.3-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="stylee.css">
    
    <link rel="stylesheet" href="register.html">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>
<body>



  
<div class="modal fade" id="signupModal" tabindex="-1" aria-labelledby="signupModalLabel" aria-hidden="true" >
  <div class="modal-dialog modal-lg" >
      <div class="modal-content" >
          <div class="modal-header "   >
              <h5 class="modal-title" id="signupModalLabel"></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="close"></button>
          </div>
          <div class="modal-body" style="padding: 0%; ">
              <iframe src="register.html" style="width: 100%; height: 700px; "></iframe>
          </div>
      </div>
  </div>
</div>





<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true" >
  <div class="modal-dialog modal-lg" >
      <div class="modal-content" >
          <div class="modal-header "   >
              <h5 class="modal-title" id="loginModalLabel"></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="close"></button>
          </div>
          <div class="modal-body" style="padding: 0%; ">
              <iframe src="Login.html" style="width: 100%; height: 700px; "></iframe>
          </div>
      </div>
  </div>
</div>




    <header class="header">
        <div class="logo">
        <img src="slide/logo.jpg" alt="">
            <div class="search-box">
                <input type="search" id="inp_search" placeholder="Search...">
                <button type="submit" id="btn_search"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>
        </div>
        <nav class="navbar">
            <ul id="sidebarr" class="sidebar">
                <li onclick="closesidebar()"><a href="javascript:void(0)"><i class="fa-solid fa-xmark"></i></a></li>
                <li><a href="#"> <i class="fa-solid fa-house"></i> Home</a></li>
                <li><a href="#"><i class="fa-solid fa-list"></i> Categories</a></li>
                <li><a href="#"><i class="fa-solid fa-right-to-bracket"></i> Sign In</a></li>
                <li><a href="#" data-bs-toggle="modal" data-bs-target="#signupModal"><i class="fa-solid fa-user-plus"></i> Sign Up</a></li>



                <li><a href="#"> <i class="fa-solid fa-cart-shopping"></i> Cart</a></li>
            </ul>

            <ul class="nav-links">
                <li class="hidenonMobile"><a href="#">Home</a></li>
                <li class="hidenonMobile dropdown">
                    <a href="#">Categories</a>
                    <ul class="dropdown-menu"  id="categoriesDropdown">
                      
                    </ul>
                </li>
                <li class="hidenonMobile"><a href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Sign In</a></li>
                <li class="hidenonMobile"><a href="#" data-bs-toggle="modal" data-bs-target="#signupModal">Sign Up</a></li>
                <li class="hidenonMobile"><a href="CartItems.html"><i class="fa-solid fa-cart-shopping"></i></a></li>
                <li class="menu-btn" onclick="showsidebar()"><a href="javascript:void(0)"><i class="fa-solid fa-bars"></i></a></li>
            </ul>
        </nav>
    </header>

 
    <div id="carouselExampleIndicators" class="carousel slide">
        <div class="carousel-indicators">
          <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
          <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
          <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="slide/img1.jpg" class="d-block w-100" alt="...">
          </div>
          <div class="carousel-item">
            <img src="slide/img2.jpg" class="d-block w-100" alt="">
          </div>
          <div class="carousel-item">
            <img src="slide/img3.jpg" class="d-block w-100" alt="...">
          </div>
        </div>
        
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>


      <div class="container">
        <div class="row" id="products-list">

          <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
            <div class="card" style="width: 100%;">
              <img src="" class="card-img-top" alt="...">
              <div class="card-body">
                <h5 class="card-title">Card title</h5>
                <p class="card-text">Some quick example text to build on the card title.</p>
                <a href="#" class="btn btn-primary">Go somewhere</a>
              </div>
            </div>
          </div>
         
            </div>
          </div>
         
          
          
          
             

      

     <div class="container1 container ">
      <div class="row">
        <div class="col">
          <img src="slide\Black and White Minimalism Fashion Influencer Instagram Post Set.jpg" class="img-fluid" alt="...">
        </div>

        <div class="col">
          <img src="slide\Baby Photo Frame Retractable Banner in Soft Peach in Organic Style.jpg" class="img-fluid" alt="...">
        </div>

        <div class="col">
          <img src="slide/White and Blue Clean New Release Smartphone Instagram Post.jpg" class="img-fluid" alt="...">
        </div>

        <div class="col">
          <img src="slide\Green Simple Photocentric Fashion Product Introduction Instagram Post.jpg" class="img-fluid h-35" alt="...">
        </div>

        <div class="col">
          <img src="1.jpg" class="img-fluid" alt="...">
        </div>
        
      </div>
     </div>



     
  
 
     <script>









      




      fetch('/getAllCategories')
      .then(response => response.json())
      .then(categories =>{
        const dropdownMenu = document.getElementById('categoriesDropdown');
        categories.forEach(category => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = '#';
          a.textContent = category.name;
          li.appendChild(a);
          dropdownMenu.appendChild(li);
        });

      })

      .catch(error =>{
        console.error('Error fetching categories:', error);
      })

      fetch("http://localhost:9000/GetAllProducts")
    .then(response => response.json())
    .then(data => {
        console.log("Fetched Products:", data.products); 
        let productsContainer = document.getElementById("products-list");
        productsContainer.innerHTML = ""; 
        

        data.products.forEach(product => {

          const imagePath = product.img_product
                    .replace(/'/g, '') 
                    .replace(/\\/g, '/');
            let productCard = `
                <div class="col-sm-6 col-md-4 col-lg-3 mb-2">
                    <div class="card" style="width: 100%;" style="height: 50%;">
                        <img src="${imagePath}" class="card-img-top" alt="${product.name}" style="height: 60%;">
                        <div class="card-body">
                            <h5 class="card-title">${product.name}</h5>
                            <p class="card-text">${product.description}</p>
                            <p class="card-text"><strong>Price:</strong> ${product.price}$</p>
                             <button class="btn btn-primary" onclick="addToCart('${product.id_product}', '${product.name}', ${product.price}, '${imagePath}')">Add to Cart</button>

                        </div>
                    </div>
                </div>`;
            productsContainer.innerHTML += productCard;
        });
    })
    .catch(error => console.error("Error fetching products:", error));

    function addToCart(idProduct,productName, productPrice, productImg) {
    let idOrder = localStorage.getItem('id_order');

   
    if (!idOrder) {
        fetch('/CreateOrder', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ Total_price: productPrice }) 
        })
        .then(response => response.json())
        .then(data => {
          console.log("Order Created:", data);
            if (data.id_order) {
                localStorage.setItem('id_order', data.id_order);
                
                // قم بإضافة المنتج للسلة بعد إنشاء الطلب
                addItemToCart(data.id_order, idProduct,productName, productPrice, productImg);
            }
        })
        .catch(error => console.error('Error creating order:', error));
    } else {
        // إذا كان الطلب موجودًا، أضف المنتج مباشرةً
        addItemToCart(idOrder, idProduct,productName, productPrice, productImg);
    }
}

function addItemToCart(orderId, idProduct,productName, productPrice, productImg) {
    let cart = JSON.parse(localStorage.getItem('cart')) || [];  
    let existingItem = cart.find(item => item.name === productName);

    if (existingItem) {
        existingItem.quantity += 1;  
    } else {
        cart.push({ id_product:idProduct,name: productName, price: productPrice, image: productImg, quantity: 1 });
    }

    localStorage.setItem('cart', JSON.stringify(cart));  

    alert("Product added to cart!");

   

fetch('http://localhost:9000/AddCartItem',{ 
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    quantity: 1,
    id_product: idProduct,
    id_order: orderId
  })
})
.then(response => response.json())
.then(data => {
  console.log("response:" ,data);
  if(data.success){
    console.log("Product added to cart" + data.message);
  }else{
    console.log("Error creating cart item" + data.message);
  }
})
.catch(error => console.error('Error adding product to cart:', error));
}







    



/*let students = ["abdo","ahmed","anass"];
localStorage.setItem("myStudents",JSON.stringify(students));


let storedstudents = localStorage.getItem("myStudents");
storedstudents.push("classe");
localStorage.setItem("myStudentts",JSON.stringify(storedstudents));
let studentsAarry = JSON.parse(storedstudents);
console.log(studentsAarry);

items = items.filter(item => item !== "anass");
console.log(items);*/


//forEach
/*let fruits = ["banana","appel","orange"];

fruits.forEach(function(fruits){
  console.log(fruits);
})

let numbers = [1,2,3,4,5,6];
numbers.forEach(num => {
  console.log(num);
})*/


      
      </script>


      
      
    
      <script src="bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>
      
      
    <script src="index.js"></script>
    
</body>
</html>